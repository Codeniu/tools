# 手写数字识别系统

基于深度学习的实时手写数字识别应用，使用卷积神经网络（CNN）在浏览器中实现高性能的数字识别。

## 项目简介

这是一个完全在浏览器中运行的深度学习应用，无需后端服务器。使用 TensorFlow.js 构建 CNN 模型，支持实时手写数字识别、模型训练和性能测试。

## 主要功能

### 🔍 数字识别
- 实时手写数字识别
- 支持鼠标和触摸输入
- 自动图像预处理（裁剪、居中、反色）
- 显示各数字预测概率
- 可调节画笔粗细

### 🎓 模型训练
- 在线训练 CNN 模型
- 使用 MNIST 真实数据集
- 实时可视化训练过程
  - 损失曲线
  - 整体训练准确率曲线
  - 测试集准确率曲线
  - 混淆矩阵
  - 各类数字准确率
- 导出完整模型（.json + .bin 文件）
- 支持自定义训练参数

### 🧪 样本集测试
- 从 MNIST 测试集随机采样
- 批量预测测试
- 显示样本图片、实际值和预测值
- 统计准确率和错误分析

### 🔧 模型管理
- 预训练模型快速加载
- 本地模型存储
- 自定义模型上传
- 模型切换和比较

## 技术架构

### 前端技术栈
- **TensorFlow.js 4.10.0**: 机器学习框架
- **Chart.js 4.4.0**: 数据可视化
- **原生 JavaScript**: 无框架依赖
- **HTML5 Canvas**: 绘图和图像处理

### 模型架构

使用经典的 CNN 架构，专为 28×28 灰度图像设计：

```
输入层 (28×28×1)
    ↓
卷积层 1 (8 filters, 5×5, ReLU)
    ↓
最大池化层 1 (2×2) → 14×14×8
    ↓
卷积层 2 (16 filters, 5×5, ReLU)
    ↓
最大池化层 2 (2×2) → 7×7×16
    ↓
展平层 → 784
    ↓
全连接层 (128 units, ReLU)
    ↓
Dropout (0.5)
    ↓
输出层 (10 units, Softmax)
```

### 图像预处理

手写图像经过以下预处理步骤：

1. **自动裁剪**: 检测数字边界，去除空白区域
2. **居中处理**: 将数字放置在画布中心
3. **尺寸缩放**: 缩放到 28×28 像素
4. **颜色反转**: 白底黑字 → 黑底白字（匹配 MNIST 格式）
5. **归一化**: 像素值从 [0, 255] 转换到 [0, 1]

## 安装和运行

### 本地开发

1. **克隆项目**
```bash
git clone <repository-url>
cd handwriting-digit-recognition
```

2. **启动本地服务器**

由于浏览器的 CORS 安全策略，需要通过 HTTP 服务器运行：

```bash
# 使用 Python 3
python -m http.server 8000

# 或使用 Node.js
npx http-server -p 8000

# 或使用 PHP
php -S localhost:8000
```

3. **访问应用**
```
http://localhost:8000
```

### 文件结构

```
handwriting-digit-recognition/
├── index.html              # 主页面
├── css/
│   └── styles.css         # 样式文件
├── js/
│   ├── main.js            # 主应用逻辑
│   ├── data-loader.js     # MNIST 数据加载
│   └── trainer.js         # 训练模块
├── mnist/
│   ├── mnist_images.png   # MNIST 图像数据
│   └── mnist_labels_uint8 # MNIST 标签数据
└── models/
    ├── mnist-cnn-full-model.json       # 预训练模型（5000样本）
    └── mnist-cnn-full-model.bin        # 模型权重
```

## 使用指南

### 数字识别

1. 确保模型已加载（默认加载预训练模型）
2. 在画布上用鼠标或触摸绘制数字（0-9）
3. 点击"识别"按钮
4. 查看识别结果和各数字概率
5. 点击"清除"清空画布重新绘制

### 模型训练

1. 切换到"模型训练"标签
2. 配置训练参数：
   - **训练集大小**: 1000-55000（建议 10000）
   - **批次大小**: 128-1024（建议 512）
   - **训练轮数**: 1-50（1 轮 = 1000 次训练）
3. 点击"开始训练"
4. 实时观察训练曲线和指标
5. 训练完成后点击"另存为模型"导出

#### 训练可视化说明

- **损失曲线**: 显示训练损失的变化趋势
- **整体训练准确率曲线**: 实时统计所有训练样本的累计准确率
- **测试准确率曲线**: 每 1000 次训练在测试集上评估
- **混淆矩阵**: 显示各数字的预测分布（每 1000 次更新）
- **各类数字准确率**: 显示 0-9 每个数字的准确率

### 样本集测试

1. 切换到"样本集测试"标签
2. 设置测试样本数量（1-500）
3. 点击"开始测试"
4. 查看测试结果：
   - 总体统计（总数、正确数、错误数、准确率）
   - 每个样本的详细信息
   - 错误样本会用红色标记

### 模型管理

#### 预训练模型

项目包含两个预训练模型：

- **mnist-cnn-full-model** (推荐)
  - 5000 样本训练
  - 准确率约 95%
  - 适合快速识别

- **mnist-trained-28x28-1767150554786**
  - 10000 样本训练
  - 准确率约 97%
  - 更高的精度

#### 自定义模型

1. **上传模型**:
   - 点击"选择 JSON 文件"
   - 选择 .json 模型文件
   - 系统自动加载同名 .bin 权重文件

2. **保存模型**:
   - 训练完成后点击"另存为模型"
   - 选择保存方式：
     - 下载为文件（推荐）: 保存 .json + .bin 文件
     - 本地存储: 保存在浏览器中

## 数据集说明

### MNIST 数据集

使用标准的 MNIST 手写数字数据集：

- **训练集**: 55,000 张图像
- **测试集**: 10,000 张图像
- **图像尺寸**: 28×28 像素，灰度图
- **类别数**: 10 类（数字 0-9）

### 数据格式

- **图像数据**: 单个 PNG 文件，包含所有图像拼接
- **标签数据**: 二进制文件，one-hot 编码

## 性能优化

### 训练优化

1. **单样本在线训练**:
   - 每次处理一个样本
   - 减少内存占用
   - 实时反馈训练进度

2. **批量测试**:
   - 每 1000 次训练进行一次批量测试
   - 测试 100 个样本获得稳定准确率
   - 减少测试频率提高训练速度

3. **可视化策略**:
   - 每 10 次训练更新曲线
   - 每 100 次更新网络状态
   - 每 1000 次更新混淆矩阵

### 推理优化

1. **图像预处理**:
   - 自动裁剪减少无关像素
   - 居中处理提高识别率
   - 反色适配训练数据格式

2. **内存管理**:
   - 及时释放 tensor 资源
   - 避免内存泄漏
   - 支持长时间使用

## 浏览器兼容性

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Edge 90+
- ✅ Safari 14+

需要支持：
- WebGL 2.0（GPU 加速）
- ES6+ JavaScript
- HTML5 Canvas
- File API

## 常见问题

### Q: 模型加载失败？
A: 确保通过 HTTP 服务器运行，不要直接打开 HTML 文件。检查 models 目录下是否存在 .json 和 .bin 文件。

### Q: 训练速度慢？
A:
- 减少训练集大小
- 降低训练轮数
- 检查浏览器是否启用了硬件加速

### Q: 手写数字识别不准确？
A:
- 尽量写得清晰、居中
- 画笔不要太细或太粗
- 使用更多样本训练模型

### Q: 如何提高识别准确率？
A:
- 增加训练轮数
- 使用更大的训练集
- 训练后保存模型并加载使用

## 开发者指南

### 添加新功能

1. **修改模型架构**: 编辑 `data-loader.js` 中的 `createModel28x28()` 函数
2. **调整预处理**: 修改 `main.js` 中的 `preprocessImage()` 函数
3. **自定义训练参数**: 修改 `trainer.js` 中的 `startTraining()` 函数

### API 参考

#### 主要函数

```javascript
// 预测
predict()

// 清除画布
clearCanvas()

// 开始训练
startTraining()

// 保存模型
saveModelAs()

// 加载模型
loadModel(modelName, modelPath, isPredefined)

// 样本测试
startSampleTesting()
```

#### 全局变量

```javascript
let model              // 当前加载的模型
let currentModelName   // 当前模型名称
let testData          // 测试集数据缓存
```

## 技术栈

- **TensorFlow.js 4.10.0** - 深度学习框架
- **Chart.js 4.4.0** - 图表可视化
- **原生 JavaScript** - 无依赖框架
- **CSS3** - 现代化 UI 设计

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！

---

**版本**: 3.0.0
**更新日期**: 2025-12-31
**享受手写数字识别的乐趣！** ✍️🔍
