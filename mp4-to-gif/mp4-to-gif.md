# MP4 转 GIF 工具使用说明

## 简介

`mp4-to-gif.html` 是一个基于浏览器的 MP4 视频转 GIF 动图工具。该工具完全在客户端运行，无需上传文件到服务器，保护用户隐私，使用方便快捷。

## 功能特点

### 核心功能
- ✅ **纯前端转换**：使用 FFmpeg WASM 技术，完全在浏览器中完成转换
- ✅ **隐私保护**：所有处理都在本地完成，不会上传到任何服务器
- ✅ **实时预览**：上传视频后可立即预览
- ✅ **参数可调**：支持自定义起始时间、持续时间、帧率和输出尺寸
- ✅ **进度显示**：实时显示转换进度百分比
- ✅ **拖拽上传**：支持点击上传和拖拽上传两种方式

### 可调参数

| 参数 | 说明 | 范围 | 默认值 |
|------|------|------|--------|
| 起始时间 | 从视频的哪一秒开始转换 | 0 - 视频结尾 | 0秒 |
| 持续时间 | 生成 GIF 的时长 | 1 - 10秒 | 5秒 |
| 帧率 (FPS) | 每秒的帧数 | 5 - 30 | 10 |
| 宽度 | 输出 GIF 的宽度（高度自动等比缩放） | 200 - 800px | 480px |

## 系统要求

### 浏览器支持
- ✅ Chrome 90+
- ✅ Edge 90+
- ✅ Firefox 88+
- ✅ Safari 15+

### 技术要求
- 支持 WebGL 2.0
- 支持 SharedArrayBuffer
- 建议使用现代浏览器的最新版本

## 使用方法

### ⚠️ 重要：必须使用特殊的 HTTP 服务器

**由于浏览器安全策略，FFmpeg WASM 需要 `SharedArrayBuffer` 支持，这需要服务器配置特定的 HTTP 头。**

普通的服务器（如 Live Server、http-server）**无法**使用！必须使用提供的 Node.js 服务器。

### 1. 启动服务器（必须步骤）

#### ✅ 方法 1：使用 Node.js 服务器（唯一推荐）

**Windows:**
1. 确保已安装 Node.js：https://nodejs.org/
2. 双击 `start-node-server.bat` 文件
3. 等待服务器启动
4. 浏览器会自动打开 `http://localhost:8080/mp4-to-gif.html`

**或者手动启动：**
```bash
# 在命令行中运行
node server.js
```

**Mac/Linux:**
```bash
# 确保已安装 Node.js
node server.js
```

然后在浏览器中访问：`http://localhost:8080/mp4-to-gif.html`

#### ❌ 不可用的方法

以下方法**不支持**，会导致 `SharedArrayBuffer is not defined` 错误：
- ❌ VS Code Live Server
- ❌ Python http.server
- ❌ http-server (npm)
- ❌ 直接双击 HTML 文件

### 原因说明

FFmpeg WASM 需要浏览器支持 `SharedArrayBuffer`，但由于安全原因（Spectre/Melody 漏洞），这个特性默认被禁用。要启用它，服务器必须发送以下 HTTP 头：

```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin
```

这就是为什么我们提供了特殊的 `server.js`，它已经配置了这些必要的头。

### 2. 上传视频
**方式一：点击上传**
- 点击上传区域（虚线框）
- 在文件选择器中选择 MP4 视频文件

**方式二：拖拽上传**
- 将 MP4 文件直接拖拽到上传区域

### 3. 预览视频
上传成功后，会显示：
- 文件信息（文件名、大小、时长）
- 视频预览播放器
- 参数调节控制面板

### 4. 调整参数
根据需要调整以下参数：

**起始时间**
- 设置从视频的哪个时间点开始截取
- 例如：设置为 5s，则从第 5 秒开始

**持续时间**
- 设置生成 GIF 的长度
- 建议：短视频片段效果更好

**帧率 (FPS)**
- 帧率越高，动画越流畅，但文件也越大
- 推荐设置：
  - 简单动画：5-10 FPS
  - 中等流畅度：10-15 FPS
  - 高流畅度：20-30 FPS

**宽度**
- 设置输出 GIF 的宽度
- 高度会自动按比例缩放
- 推荐：320-480px（文件大小适中）

### 5. 开始转换
- 点击 **"🎬 开始转换"** 按钮
- 等待转换完成（进度条显示实时进度）
- 转换时间取决于视频长度和设置的参数

### 6. 下载 GIF
- 转换完成后会自动显示生成的 GIF 预览
- 点击 **"⬇️ 下载 GIF"** 按钮保存到本地

## 使用场景

### 适合的用途
- 📱 **社交媒体分享**：制作动态表情包、短视频片段
- 💬 **聊天通讯**：制作有趣的动图用于聊天
- 📝 **教程演示**：录制操作步骤并转换为 GIF
- 🎨 **创意设计**：从视频中提取精彩瞬间
- 📊 **文档说明**：为文档添加动态演示

### 最佳实践

1. **控制时长**：建议 GIF 时长不超过 5 秒，文件会更小
2. **合理设置帧率**：不是所有场景都需要高帧率，10-15 FPS 通常足够
3. **适当降低分辨率**：320-480px 宽度适合大多数场景
4. **选择合适的内容**：动作简单、色彩鲜明的视频效果更好
5. **避免过大的文件**：GIF 文件过大会影响加载速度

## 技术实现

### 技术栈
- **HTML5**：页面结构
- **CSS3**：渐变背景、动画效果
- **JavaScript (ES6+)**：业务逻辑
- **FFmpeg WASM**：视频处理核心

### CDN 资源
```javascript
// FFmpeg 核心
https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/umd/ffmpeg.js

// FFmpeg 工具库
https://unpkg.com/@ffmpeg/util@0.12.1/dist/umd/index.js

// FFmpeg Core (WASM)
https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd/ffmpeg-core.js
```

### 转换命令
工具使用的 FFmpeg 命令格式：
```bash
ffmpeg -i input.mp4 \
  -ss [起始时间] \
  -t [持续时间] \
  -vf "fps=[帧率],scale=[宽度]:-1:flags=lanczos" \
  -gifflags +transdiff \
  output.gif
```

## 常见问题

### Q: 为什么会报错 "SharedArrayBuffer is not defined"？
**A:** 这是因为使用了不支持 `SharedArrayBuffer` 的服务器。FFmpeg WASM 需要这个特性，而普通的服务器（Live Server、Python http.server 等）没有配置必要的 HTTP 头。

**解决方法：必须使用提供的 Node.js 服务器**
```bash
# Windows: 双击 start-node-server.bat
# 或者手动运行:
node server.js
```

然后在浏览器访问：`http://localhost:8080/mp4-to-gif.html`

### Q: 首次打开时显示"加载 FFmpeg 中"？
**A:** 这是正常现象。首次使用需要从 CDN 下载 FFmpeg WASM 核心文件（约 25-30MB），请确保网络连接正常。加载完成后会自动缓存，下次使用会更快。

### Q: 转换速度慢怎么办？
**A:** 转换速度取决于：
- 视频时长和分辨率
- 电脑性能
- 设置的参数

建议：
- 缩短转换时长
- 降低输出分辨率
- 降低帧率

### Q: 转换失败怎么办？
**A:** 可能的原因和解决方案：
1. **浏览器不支持**：升级到最新版本的 Chrome、Edge 或 Firefox
2. **视频文件损坏**：尝试用其他视频文件测试
3. **内存不足**：关闭其他浏览器标签页，或降低视频分辨率
4. **网络问题**：检查 CDN 连接是否正常

### Q: 生成的 GIF 文件太大？
**A:** 减小文件大小的方法：
- 减少持续时间（使用更短的视频片段）
- 降低帧率（从 30fps 降到 10-15fps）
- 降低分辨率（从 800px 降到 320-480px）

### Q: 为什么某些浏览器无法使用？
**A:** FFmpeg WASM 需要：
- SharedArrayBuffer 支持
- WebGL 2.0 支持

如果浏览器不支持这些特性，工具将无法正常运行。建议使用最新版本的现代浏览器。

### Q: 可以同时转换多个视频吗？
**A:** 当前版本一次只能转换一个视频。如需转换多个视频，请依次进行。

## 注意事项

⚠️ **性能提示**
- 转换过程会占用较多 CPU 和内存资源
- 建议关闭不需要的浏览器标签页
- 长时间转换时注意电脑散热

⚠️ **文件大小**
- GIF 格式不适合长时间、高分辨率视频
- 建议单次转换不超过 10 秒
- 输出宽度建议不超过 480px

⚠️ **浏览器兼容性**
- 某些旧版浏览器可能不支持
- 建议使用 Chrome、Edge 或 Firefox 的最新版本
- 移动端浏览器支持可能有限

⚠️ **隐私声明**
- 所有转换均在浏览器本地完成
- 不会上传任何文件到外部服务器
- 但会从 CDN 下载必要的 FFmpeg 库文件

## 更新日志

### v1.0.0 (2025-12-30)
- ✨ 初始版本发布
- ✅ 支持 MP4 转 GIF
- ✅ 可调节起始时间、持续时间、帧率和宽度
- ✅ 拖拽上传支持
- ✅ 实时进度显示
- ✅ 美观的用户界面

## 许可证

本工具基于 FFmpeg WASM 构建，遵循相应的开源许可证。

## 技术支持

如遇到问题，请检查：
1. 浏览器版本是否为最新
2. 控制台是否有错误信息（F12 打开开发者工具）
3. 网络连接是否正常（需要访问 CDN）

---

**享受使用！** 🎬✨
