# 图片拼接工具 - Image Merger

功能强大的图片拼接工具，采用智能布局模式，支持自由拖拽、缩放、旋转图片，满足各种图片编辑需求。

## 简介

图片拼接工具是一个完全运行在浏览器中的在线工具，采用智能布局模式。支持自由拖拽、缩放、旋转图片，类似专业设计软件的体验。所有处理都在本地完成，无需上传到服务器，确保您的图片隐私安全。

## 主要功能

### 核心特性 ✨

- ✅ **自由拖拽** - 在画布上自由拖拽图片到任意位置
- ✅ **拖拽缩放** - 拖拽图片角落控制点调整大小，控制点保持固定视觉大小
- ✅ **智能吸附** - 三级吸附系统：画布边缘 > 图片边缘 > 网格线
- ✅ **图片旋转** - 0-360度自由旋转
- ✅ **属性面板** - 精确设置位置、大小、旋转角度、缩放比例
- ✅ **图层管理** - 支持调整图片层级（置顶/置底）
- ✅ **画布设置** - 自定义画布尺寸和背景颜色
- ✅ **网格辅助** - 可选的网格线显示和智能吸附
- ✅ **缩放控制** - 支持放大、缩小、适应屏幕
- ✅ **实时预览** - 所有操作实时预览
- ✅ **多格式输出** - 支持 PNG、JPEG、WebP 格式

### 智能布局操作说明

**画布操作：**
- 🖱️ **选择图片** - 点击画布上的图片或左侧图片列表
- 🖱️ **拖拽移动** - 选中图片后拖拽到目标位置（智能吸附）
- 🖱️ **拖拽缩放** - 拖拽选中框的四个角调整大小
- ⌨️ **Delete键** - 删除选中的图片
- 🎯 **智能吸附** - 自动对齐到画布边缘、其他图片或网格线

**属性面板：**
- 📍 **X/Y位置** - 精确设置图片坐标
- 📐 **宽度/高度** - 精确设置图片尺寸
- 🔄 **旋转角度** - 0-360度旋转
- 🔍 **缩放比例** - 10%-300%缩放
- ⬆️⬇️ **图层调整** - 置顶/置底按钮

## 使用说明

### 快速上手

1. **上传图片**
   - 点击上传区域选择图片
   - 或直接拖拽图片到上传区域
   - 支持一次选择多张图片

2. **编辑图片**
   - 点击图片选中（显示蓝色边框和控制点）
   - 拖拽图片移动位置（会智能吸附）
   - 拖拽四个角的控制点调整大小

3. **导出结果**
   - 点击"下载结果"按钮
   - 选择保存格式（PNG/JPEG/WebP）
   - 完成下载

### 智能吸附详解

工具采用三级智能吸附系统，按优先级自动对齐：

**第一级：画布边缘吸附（最高优先级）**
- 画布左边缘（x=0）
- 画布右边缘（x=画布宽度）
- 画布水平中心
- 画布上边缘（y=0）
- 画布下边缘（y=画布高度）
- 画布垂直中心

**第二级：图片边缘吸附**
- 与其他图片的左边缘对齐
- 与其他图片的右边缘对齐
- 与其他图片的中心对齐
- 与其他图片的上边缘对齐
- 与其他图片的下边缘对齐

**第三级：网格吸附（兜底）**
- 20px网格线吸附
- 当前两个级别都没有触发时使用

**吸附阈值**：10像素
- 当距离对齐线小于10px时自动吸附
- 既灵敏又不会过于频繁

### 使用技巧

#### 智能吸附使用技巧

1. **快速居中**
   ```
   拖拽图片靠近画布中心 → 自动吸附到中心线
   ```

2. **边缘对齐**
   ```
   拖拽图片靠近画布边缘 → 自动贴边
   ```

3. **图片对齐**
   ```
   拖拽图片靠近其他图片 → 自动对齐边缘或中心
   ```

4. **精确调整**
   ```
   关闭"启用网格吸附" → 自由移动
   开启"启用网格吸附" → 20px网格对齐
   ```

#### 常见应用场景

1. **制作拼贴画**
   ```
   - 网格吸附：开启
   - 操作：自由摆放照片，创建艺术拼贴
   - 技巧：使用图片边缘吸附快速对齐
   ```

2. **制作信息图**
   ```
   - 网格吸附：开启
   - 操作：精确对齐元素，保持整齐布局
   - 技巧：使用画布中心快速居中元素
   ```

3. **制作产品展示**
   ```
   - 网格吸附：开启
   - 操作：多角度展示产品，调整大小突出重点
   - 技巧：使用边缘吸附确保图片整齐排列
   ```

4. **制作社交媒体图片**
   ```
   - 画布：1080x1080（Instagram方形）
   - 网格吸附：开启
   - 操作：自由设计创意图片
   - 技巧：使用中心吸附创建对称布局
   ```

## 应用场景

### 创意设计
- 🎨 **拼贴画创作** - 自由拼接照片创作艺术作品
- 🎨 **海报设计** - 快速制作简单海报
- 🎨 **社交媒体图片** - Instagram、小红书等平台配图
- 🎨 **邀请函制作** - 活动邀请、节日贺卡

### 专业用途
- 💼 **产品展示** - 多角度产品展示图
- 💼 **UI设计稿** - 界面设计稿拼接展示
- 💼 **信息图制作** - 数据可视化图表
- 💼 **演示文稿** - 快速制作演示素材

### 教育培训
- 📚 **教材制作** - 知识点图示
- 📚 **课件制作** - 教学素材整理
- 📚 **思维导图** - 知识结构图

## 技术特点

### 技术栈
- **HTML5 Canvas** - 核心渲染引擎
- **Tailwind CSS** - 现代化UI框架
- **JavaScript (ES6+)** - 核心逻辑和交互
- **File API** - 文件读取和操作
- **Blob API** - 二进制数据处理

### 智能布局实现原理

**1. 画布渲染系统**
```javascript
// 实时渲染画布
function render() {
    // 清空画布并填充背景色
    ctx.fillStyle = canvasSettings.bgColor;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // 绘制网格（可选）
    if (canvasSettings.showGrid) {
        drawGrid();
    }

    // 绘制所有图片
    uploadedImages.forEach(image => {
        drawImage(image);
    });

    // 绘制选中框
    if (selectedImageId) {
        const image = uploadedImages.find(img => img.id === selectedImageId);
        if (image) {
            drawSelectionBox(image);
        }
    }
}
```

**2. 图片变换系统**
```javascript
// 绘制图片（支持旋转、缩放）
function drawImage(image) {
    ctx.save();

    // 计算变换后的实际尺寸和位置
    const actualWidth = image.width * image.scale;
    const actualHeight = image.height * image.scale;
    const centerX = image.x + actualWidth / 2;
    const centerY = image.y + actualHeight / 2;

    // 应用变换
    ctx.translate(centerX, centerY);
    ctx.rotate((image.rotation * Math.PI) / 180);
    ctx.scale(image.scale, image.scale);

    // 绘制图片（居中绘制）
    ctx.drawImage(
        image.element,
        -image.width / 2,
        -image.height / 2,
        image.width,
        image.height
    );

    ctx.restore();
}
```

**3. 智能吸附系统**
```javascript
// 三级吸附系统
function getSnappedPosition(x, y, currentImage) {
    // 1. 优先吸附画布边缘
    //    - 左边缘、右边缘、水平中心
    //    - 上边缘、下边缘、垂直中心

    // 2. 吸附到其他图片边缘
    //    - 其他图片的左、右、中心
    //    - 其他图片的上、下、中心

    // 3. 网格吸附（兜底）
    //    - 20px网格线

    return { x: snappedX, y: snappedY };
}
```

**4. 固定大小控制点**
```javascript
// 控制点固定视觉大小
const baseHandleSize = 8; // 基础大小
const handleSize = baseHandleSize / image.scale; // 反向缩放
// 控制点在视觉上始终保持8px，不受图片缩放影响
```

### 性能优化
- **Canvas硬件加速** - 利用GPU加速渲染
- **事件节流** - 优化鼠标移动事件处理
- **懒加载** - 图片按需加载
- **内存管理** - 及时释放不再使用的资源

### 浏览器兼容性

| 浏览器 | 版本要求 | 支持程度 |
|--------|----------|----------|
| Chrome | 60+ | ⭐⭐⭐⭐⭐ |
| Edge | 79+ | ⭐⭐⭐⭐⭐ |
| Firefox | 55+ | ⭐⭐⭐⭐⭐ |
| Safari | 11+ | ⭐⭐⭐⭐ |

## 隐私与安全

### 数据安全
- ✅ 所有图片处理在浏览器本地完成
- ✅ 不上传任何文件到服务器
- ✅ 不收集任何用户信息
- ✅ 完全离线可用，无需网络连接（首次加载除外）

### 数据控制
- 用户完全控制自己的图片
- 图片不会离开您的设备
- 可以随时关闭页面清除数据
- 不存在数据泄露风险

## 快速启动

### 方式一：直接打开
```bash
# 在浏览器中打开
open image-merger/index.html

# 或者双击文件打开
```

### 方式二：通过首页访问
```bash
# 在项目根目录打开
open index.html
# 点击"图片拼接工具"卡片
```

### 方式三：本地服务器（推荐）
```bash
# 使用 Python 启动
python -m http.server 8000

# 使用 Node.js 启动
npx http-server

# 访问 http://localhost:8000/image-merger/
```

## 功能限制与注意事项

### 当前限制
- 建议单次拼接不超过 20 张图片
- 建议单张图片大小不超过 20MB
- 支持的图片格式：JPG、PNG、GIF、WebP 等
- 旋转后暂不支持拖拽调整大小（可通过属性面板调整）

### 使用建议

1. **网格吸附**
   - 制作需要精确对齐的图片时建议开启
   - 自由创作时可以关闭

2. **画布尺寸**
   - 根据输出需求设置合适尺寸
   - 常用尺寸：1920x1080、1080x1080、1080x1920

3. **图层管理**
   - 合理安排图层顺序，避免遮挡
   - 使用"置顶"/"置底"快速调整

4. **缩放控制**
   - 使用"适应屏幕"查看整体效果
   - 放大查看细节，缩小查看全局

5. **格式选择**
   - 需要透明背景选择 PNG
   - 照片类图片选择 JPEG 或 WebP
   - 追求小体积选择 WebP

## 常见问题

**Q1: 智能吸附是如何工作的？**
A: 工具采用三级吸附系统。当拖拽图片时，会优先检测是否靠近画布边缘（10px内），然后检测是否靠近其他图片边缘，最后使用网格线吸附。这样既保证了快速对齐，又提供了精细控制。

**Q2: 如何精确控制图片位置？**
A: 有两种方式：
1. 关闭网格吸附后自由拖拽
2. 选中图片后在左侧属性面板输入精确的坐标值

**Q3: 控制点为什么不会变大变小？**
A: 这是通过反向缩放技术实现的。控制点使用固定的视觉大小（8px），在绘制时根据图片缩放比例进行反向计算，确保控制点始终保持相同大小，易于点击。

**Q4: 可以旋转图片吗？**
A: 可以。在智能布局模式下，使用属性面板的"旋转角度"滑块可以0-360度旋转图片。

**Q5: 如何调整图层顺序？**
A: 选中图片后，在属性面板点击"置顶"或"置底"按钮调整图层顺序。

**Q6: 支持键盘快捷键吗？**
A: 支持。Delete或Backspace键删除选中的图片。

**Q7: 网格线会导出到最终图片吗？**
A: 会。如果开启"显示网格线"，网格会被绘制到画布上并导出。建议导出前关闭网格线显示。

**Q8: 导出的图片质量会下降吗？**
A:
- PNG 格式：不会下降（无损）
- JPEG/WebP 格式：可能有轻微损失（质量设为 90%）

## 更新日志

### v2.1.0 (2025-01-05)
- ✨ 优化智能吸附系统（三级吸附）
- ✅ 控制点固定视觉大小，不随图片缩放
- ✅ 添加画布边框和容器背景网格
- ✅ 移除经典模式，专注智能布局
- ✅ 添加网格线显示/隐藏配置项
- 🎨 优化UI布局和交互体验

### v2.0.0 (2025-01-05)
- ✨ 新增智能布局模式
- ✅ 支持自由拖拽图片
- ✅ 支持拖拽缩放
- ✅ 支持图片旋转
- ✅ 支持网格吸附
- ✅ 新增图片属性面板
- ✅ 新增图层管理功能
- ✅ 新增画布缩放控制
- 🎨 全新UI设计

### v1.0.0 (2025-01-04)
- ✨ 首次发布
- ✅ 支持水平和垂直拼接
- ✅ 支持批量上传图片
- ✅ 支持拖拽上传
- ✅ 支持顺序调整
- ✅ 支持间距和背景颜色设置
- ✅ 支持多种输出格式
- ✅ 完全本地处理

---

**享受创作！** 🖼️✨🔗
